<!DOCTYPE html>
<html lang="ta">

<head>
    <meta charset="UTF-8">
    <title>ஆடியோ கோப்பிலிருந்து உரை மாற்றுதல்</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='upload.css') }}">
</head>

<body>
    <nav>
        <a href="/" class="home-btn">
        <img src="{{ url_for('static', filename='images/home.jpg') }}" alt="முகப்பு" class="home-icon">
    </a>
    </nav>
    <div class="container">
        <h1>ஆடியோ கோப்பிலிருந்து உரை மாற்றுதல்</h1>
        <p>ஆடியோ கோப்பை தேர்ந்தெடுத்து, மொழியை தெரிவுசெய்து "உரை மாற்று" பொத்தானை அழுத்துங்கள். சில விநாடிகளில் உரை கீழே காண்பிக்கப்படும்.</p>
        <hr>
        <form id="uploadForm" style="margin-top: -20px;" enctype="multipart/form-data">
            <label for="audioFile">ஆடியோ கோப்பை தேர்ந்தெடுக்கவும் (.mp3, .wav, .m4a):</label>
            <input type="file" id="audioFile" name="audio" accept="audio/*" required>
            
            <div class="language-selectors">
                <div>
                    <label for="source_language">ஆடியோ மொழியை தேர்ந்தெடுக்கவும்:</label>
                    <select id="source_language" name="source_language" required>
                        <option value="ta">தமிழ்</option>
                        <option value="en">ஆங்கிலம்</option>
                        <option value="hi">ஹிந்தி</option>
                        <option value="kn">கன்னடம்</option>
                        <option value="te">தெலுங்கு</option>
                        <option value="ml">மலையாளம்</option>
                        <option value="bn">பெங்காலி</option>
                        <option value="ur">உருது</option>
                    </select>
                </div>
                <div>
                    <label for="language">வெளியீட்டு உரை மொழி:</label>
                    <select id="language" name="language" required>
                        <option value="ta">தமிழ்</option>
                        <option value="en">ஆங்கிலம்</option>
                        <option value="hi">ஹிந்தி</option>
                        <option value="kn">கன்னடம்</option>
                        <option value="te">தெலுங்கு</option>
                        <option value="ml">மலையாளம்</option>
                        <option value="bn">பெங்காலி</option>
                        <option value="ur">உருது</option>
                    </select>
                </div>
            </div>

            <button type="submit" id="submitBtn">உரை மாற்று</button>
        </form>

        <div id="results" style="display: none;">
            <h2>உரை மாற்றல் முடிவு</h2>
            <div id="transcriptionBox" class="dialog-box"></div>
            <a id="downloadLink" href="#" style="display: none;" download>ஸ்கிரிப்டை பதிவிறக்கம் செய்யவும் (.txt)</a>
        </div>
    </div>

    <script>
        document.getElementById('uploadForm').addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent default form submission

            const formData = new FormData(this);
            const submitBtn = document.getElementById('submitBtn');

            submitBtn.disabled = true;
            submitBtn.innerText = 'Processing...';

            // Hide previous results
            document.getElementById('transcriptionBox').innerText = '';
            document.getElementById('downloadLink').style.display = 'none';

            fetch('/process_file', {
                method: 'POST',
                body: formData
            })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(err => { throw new Error(err.error) });
                    }
                    return response.json();
                })
                .then(data => {
                    document.getElementById('transcriptionBox').innerText = data.transcription;

                    // Correctly set the href attribute and make the link visible
                    const downloadLink = document.getElementById('downloadLink');
                    downloadLink.href = data.download_link;
                    downloadLink.style.display = 'block';

                    document.getElementById('results').style.display = 'block';
                })
                .catch(error => {
                    alert('An error occurred: ' + error.message);
                })
                .finally(() => {
                    submitBtn.disabled = false;
                    submitBtn.innerText = 'Transcribe';
                });
        });
    </script>
</body>

</html>